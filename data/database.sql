CREATE DATABASE allegro;

CREATE USER 'allegro'@'localhost' IDENTIFIED BY '[PASSWORD]';
GRANT ALL PRIVILEGES ON allegro.* TO 'allegro'@'localhost';
FLUSH PRIVILEGES;

USE allegro;

CREATE TABLE allegro.User (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  email VARCHAR(255) NOT NULL,
  username VARCHAR(255) NOT NULL,
  password CHAR(60) NOT NULL,
  createdOn TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  lastActive TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  firstName VARCHAR(255) NOT NULL,
  lastName VARCHAR(255) NOT NULL,
  emailVerified TINYINT(1) NOT NULL DEFAULT '0',
  emailNotify TINYINT(1) NOT NULL DEFAULT '1',
  emailInform TINYINT(1) NOT NULL DEFAULT '1',
  displayOnline TINYINT(1) NOT NULL DEFAULT '1',
  displayEmail TINYINT(1) NOT NULL DEFAULT '1'
);

CREATE TABLE allegro.Message (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  author INT UNSIGNED NOT NULL,
  recipient INT UNSIGNED NOT NULL,
  createdOn TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  status CHAR(1) NOT NULL DEFAULT 'S',
  subject VARCHAR(255) NOT NULL,
  body TEXT NOT NULL
);

CREATE TABLE allegro.VerificationToken (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user INT UNSIGNED NOT NULL,
  token CHAR(32) NOT NULL,
  createdOn TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  lifespan INT UNSIGNED NOT NULL
);

CREATE TABLE allegro.SupportTicket (
  id INT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
  user INT UNSIGNED NOT NULL,
  solved TINYINT(1) NOT NULL DEFAULT '0',
  createdOn TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  subject VARCHAR(255) NOT NULL,
  body TEXT NOT NULL
);
